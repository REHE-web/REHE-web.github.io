<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>服务端开发复习 | REHE's Blog</title><meta name="author" content="REHE"><meta name="copyright" content="REHE"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="建立开发环境依赖 spring-boot-devtools 开发期工具  代码变更后应用会自动重启（需要借助 IDE 的自动编译） 当面向浏览器的资源（如模板、JavaScript、样式表）等发生变化时，会自动刷新浏览器 应用会暴露 LiveReload 端口，日志如：LiveReload server is running on port 35729 需要安装 VSCode 插件 LiveRel"><meta property="og:type" content="article"><meta property="og:title" content="服务端开发复习"><meta property="og:url" content="http://example.com/2023/04/08/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91%E5%A4%8D%E4%B9%A0/index.html"><meta property="og:site_name" content="REHE&#39;s Blog"><meta property="og:description" content="建立开发环境依赖 spring-boot-devtools 开发期工具  代码变更后应用会自动重启（需要借助 IDE 的自动编译） 当面向浏览器的资源（如模板、JavaScript、样式表）等发生变化时，会自动刷新浏览器 应用会暴露 LiveReload 端口，日志如：LiveReload server is running on port 35729 需要安装 VSCode 插件 LiveRel"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/fuwu.png"><meta property="article:published_time" content="2023-04-08T08:20:00.000Z"><meta property="article:modified_time" content="2023-04-08T08:20:00.000Z"><meta property="article:author" content="REHE"><meta property="article:tag" content="复习"><meta property="article:tag" content="服务端开发"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/img/fuwu.png"><link rel="shortcut icon" href="/img/mountain_icon.ico"><link rel="canonical" href="http://example.com/2023/04/08/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91%E5%A4%8D%E4%B9%A0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="/css/fonts.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:void 0,translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:200},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!0,post:!0},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:50,languages:{author:"作者: REHE",link:"链接: ",source:"来源: REHE's Blog",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isAnchor:!1,percent:{toc:!0,rightside:!0}}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"服务端开发复习",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-04-08 16:20:00"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise(((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)})),e.getCSS=(e,t=!1)=>new Promise(((o,n)=>{const a=document.createElement("link");a.rel="stylesheet",a.href=e,t&&(a.id=t),a.onerror=n,a.onload=a.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,o())},document.head.appendChild(a)})),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/background.css"><link rel="stylesheet" href="/css/fonts.css"><link rel="stylesheet" href="/css/loading.css"><link rel="stylesheet" href="/css/progress_bar.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",(()=>{preloader.endLoading()}))</script><link rel="stylesheet" href="/css/progress_bar.css"><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-torii-gate"></i> <span>主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-list-ul"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw fas fa-blog"></i> <span>日志</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url('/img/fuwu.png')"><nav id="nav"><span id="blog-info"><a href="/" title="REHE's Blog"><span class="site-name">REHE's Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-torii-gate"></i> <span>主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-list-ul"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw fas fa-blog"></i> <span>日志</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">服务端开发复习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-04-08T08:20:00.000Z" title="发表于 2023-04-08 16:20:00">2023-04-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-04-08T08:20:00.000Z" title="更新于 2023-04-08 16:20:00">2023-04-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%8D%E4%B9%A0%E8%B5%84%E6%96%99/">复习资料</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>28分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="服务端开发复习"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="建立开发环境"><a href="#建立开发环境" class="headerlink" title="建立开发环境"></a>建立开发环境</h1><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><ul><li><p><strong>spring-boot-devtools</strong></p><p><strong>开发期工具</strong></p><ul><li>代码变更后应用会自动重启（需要借助 IDE 的自动编译）</li><li>当面向浏览器的资源（如模板、JavaScript、样式表）等发生变化时，会自动刷新浏览器<ul><li>应用会暴露 LiveReload 端口，日志如：<code>LiveReload server is running on port 35729</code></li><li>需要安装 VSCode 插件 LiveReload （IntelliJ IDEA 要做的配置见下页 ppt）</li><li>需要安装浏览器插件：LiveReload，并打开</li></ul></li><li>自动禁用（页面渲染的）模板缓存</li><li>如果使用 H2 数据库，则内置了 H2 控制台。访问：<a target="_blank" rel="noopener" href="http://localhost:8080/h2-consle">http://localhost:8080/h2-consle</a></li></ul><p><strong>只是在运行期使用，依赖范围：Runtime；与编译无关</strong></p></li><li><p>spring-boot-starter-web</p></li><li><p>spring-boot-starter-thymeleaf</p></li></ul><h2 id="源代码仓库管理"><a href="#源代码仓库管理" class="headerlink" title="源代码仓库管理"></a>源代码仓库管理</h2><ul><li>也称为版本控制（version control）系统，常用工具有：GitLab、SVN（Subversion）、Bitbucket 等</li><li>需纳入版本控制的有：功能代码、测试代码、测试脚本、构建脚本、部署脚本、配置文件等</li><li>从暂存区（index）提交到本地仓库（Repository）使用的命令是 <code>git commit</code></li></ul><h1 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h1><p>依赖注入（Dependency Injection），又叫控制反转（IoC）</p><h2 id="核心技术"><a href="#核心技术" class="headerlink" title="核心技术"></a>核心技术</h2><ul><li>DI (Dependency Injection)：保留抽象接口，让组件（Component）依赖于抽象接口，当组件要与其他实际的对象发生依赖关系时，由抽象接口来注入依赖的实际对象</li><li>AOP (Aspect Oriented Programming)：通过预编译方式和运行期间动态代理实现程序功能的统一维护的一种技术。利用 AOP 可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发效率</li></ul><h2 id="Spring-的核心是提供了一个容器（container）"><a href="#Spring-的核心是提供了一个容器（container）" class="headerlink" title="Spring 的核心是提供了一个容器（container）"></a>Spring 的核心是提供了一个容器（container）</h2><p><img src="/img/%E5%AE%B9%E5%99%A8.png" alt="容器"></p><h2 id="Spring-配置方案"><a href="#Spring-配置方案" class="headerlink" title="Spring 配置方案"></a>Spring 配置方案</h2><ol><li>自动化配置<ul><li>组件扫描（component scanning）<ul><li><code>@Configuration</code></li><li><code>@ComponentScan</code></li><li><code>@Component</code>：实例化当前类，在上下文中创建对象</li></ul></li><li>自动装配（autowiring）<ul><li><code>@Autowired</code>：把上下文里的另外一个对象注入到当前对象，并建立依赖关系</li><li>用在构造器</li><li>用在属性 <code>Setter</code> 方法</li><li>用在（私有）属性</li><li><code>required=false</code></li></ul></li></ul></li><li>JavaConfig</li><li>XML配置</li></ol><h2 id="Bean-的作用域"><a href="#Bean-的作用域" class="headerlink" title="Bean 的作用域"></a>Bean 的作用域</h2><p><code>@Scope</code> 可以与 <code>@Component</code> 和 <code>@Bean</code> 一起使用，指定作用域</p><ul><li><code>Singleton</code>，单例，不使用 <code>@Scope</code> 时默认，在整个应用中，只创建 bean 的一个实例</li><li><code>Prototype</code>，原型，每次注入或者通过 Spring 应用上下文获取的时候，都会创建一个新 bean 实例</li><li><code>Session</code>，会话，在 Web 应用中，为每个会话创建一个 bean 实例</li><li><code>Request</code>，请求，在 Web 应用中，为每个请求创建一个 bean 实例</li></ul><p>使用会话和请求作用域</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(value=WebApplicationContext.SCOPE_SESSION, proxyMode=ScopedProxyMode.INTERFACES)</span></span><br><span class="line"><span class="keyword">public</span> ShoppingCart <span class="title function_">cart</span><span class="params">()</span>&#123;...&#125;</span><br></pre></td></tr></table></figure><h1 id="AOP-面向切面编程"><a href="#AOP-面向切面编程" class="headerlink" title="AOP 面向切面编程"></a>AOP 面向切面编程</h1><h2 id="AOP术语"><a href="#AOP术语" class="headerlink" title="AOP术语"></a>AOP术语</h2><ul><li>通知（Advice）：切面做什么以及何时做<ul><li><code>@Before</code></li><li><code>@After</code></li><li><code>@AfterReturning</code></li><li><code>@AfterThrowing</code></li><li><code>@Around</code></li></ul></li><li>切点（Pointcut）：何处</li><li>切面（Aspect）：Advice 和 Pointcut 的结合</li><li>连接点（Join point）：方法、字段修改、构造方法（Spring 只能在<strong>方法</strong>处切面）</li><li>引入（introduction）：引入新的行为和状态</li><li>织入（Weaving）：切面应用到目标对象的过程（Spring 只能在运行期织入，使用代理对象）</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span><span class="comment">//@Aspect没有@Component注解的效果，需要在配置类里添加实例化或在这里加上@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Audience</span> &#123;</span><br><span class="line">    <span class="meta">@Before(&quot;execution(* concert.Performance.perform( .. ))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">silenceCellPhones</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Silencing cell phones&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* concert.Performance.perform( .. ))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">takeSeats</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Taking seats&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(&quot;execution(* concert.Performance.perform( .. ))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">applause</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;CLAP CLAP CLAP!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;execution(* concert.Performance.perform( .. ))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">demandRefund</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Demand a refund&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@Controller</code>、<code>@Service</code> 和 <code>@Repository</code> 三个注解本身有 <code>@Component</code> 的实例化效果。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Audience2</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* concert.Performance.perform( .. )) &quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">performance</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;performance()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">watchPerformance</span><span class="params">(ProceedingJoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;.Silencing cell phones&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;.Taking seats&quot;</span>);</span><br><span class="line">            joinPoint.proceed();</span><br><span class="line">            System.out.println(<span class="string">&quot;.CLAP CLAP CLAP!!!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;.Demanding a refund&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span> <span class="comment">//开启AspectJ的自动代理机制</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcertConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Performance <span class="title function_">concert</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Concert</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> EncoreableIntroducer <span class="title function_">encoreableIntroducer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EncoreableIntroducer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="AspectJ-切点指示器（pointcut-designator）"><a href="#AspectJ-切点指示器（pointcut-designator）" class="headerlink" title="AspectJ 切点指示器（pointcut designator）"></a>AspectJ 切点指示器（pointcut designator）</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Pointcut(</span></span><br><span class="line"><span class="meta">			&quot;execution(* soundsystem.CompactDisc.playTrack( int )) &quot; +</span></span><br><span class="line"><span class="meta">					&quot;&amp;&amp; args(trackNumber)&quot;)</span> <span class="comment">//获取参数</span></span><br><span class="line">&amp;&amp; within(soundsystem.*) <span class="comment">//限定包路径</span></span><br><span class="line">&amp;&amp; bean(sgtPeppers) <span class="comment">//限定bean名称，或者： &amp;&amp; !bean(sgtPeppers)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//例子</span></span><br><span class="line"><span class="meta">@Pointcut(</span></span><br><span class="line"><span class="meta">            &quot;execution(* soundsystem.CompactDisc.playTrack( int )) &quot; +</span></span><br><span class="line"><span class="meta">                    &quot;&amp;&amp; args(trackNumber)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">trackPlayed</span><span class="params">(<span class="type">int</span> trackNumber)</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;@annotation(innerAuth)&quot;)</span> <span class="comment">//限定注解</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">innerAround</span><span class="params">(ProceedingJoinPoint point, InnerAuth innerAuth)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@InnerAuth</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Boolean&gt; <span class="title function_">register</span><span class="params">(<span class="meta">@RequestBody</span> SysUser sysUser)</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure><h1 id="Web开发框架（Web-MVC）"><a href="#Web开发框架（Web-MVC）" class="headerlink" title="Web开发框架（Web MVC）"></a><strong>Web开发框架（Web MVC）</strong></h1><h2 id="Lombok"><a href="#Lombok" class="headerlink" title="Lombok"></a>Lombok</h2><ul><li><p>依赖</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>编译期后就不需要了，要排除</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br></pre></td></tr></table></figure><p>简化 Java 代码的书写，提供一些注解，自动生成一些方法。</p><p>另外需要安装 <code>IntelliJ IDEA</code> 插件 <code>Lombok</code></p></li></ul><h2 id="Spring-MVC的请求映射注解"><a href="#Spring-MVC的请求映射注解" class="headerlink" title="Spring MVC的请求映射注解"></a>Spring MVC的请求映射注解</h2><ul><li><code>@RequestMapping</code>（通用请求，可以放在类或者方法上）</li><li><code>@GetMapping</code></li><li><code>@PostMapping</code></li><li><code>@PutMapping</code></li><li><code>@DeleteMapping</code></li><li><code>@PatchMapping</code></li></ul><h2 id="Spring-Web-开发框架的分层"><a href="#Spring-Web-开发框架的分层" class="headerlink" title="Spring Web 开发框架的分层"></a>Spring Web 开发框架的分层</h2><p><img src="/img/%E5%88%86%E5%B1%82.png" alt="分层"></p><p>客户端请求参数分类：</p><ol><li><p>路径参数，<code>@PathVariable</code></p></li><li><p>请求参数（查询参数），<code>@RequestParam</code></p></li><li><p>表单参数，应用于前后端不分离的传统场景，默认，对应 model 对象，可以使用 <code>@Valid</code> 校验</p></li><li><p><code>json</code> 请求体，应用于前后端分离的场景，使用 <code>@RequestBody</code> 把 <code>json</code> 格式转成 Java 对象；<code>@ResponseBody</code>，把 Java 对象转成 <code>json</code> 格式</p></li><li><p>控制器获取客户端请求 → 业务层处理（数据持久化）→ 数据访问层</p></li><li><p>数据访问层 → 业务层（返回结果）→ 控制器 →</p><ul><li>前后端不分离：控制器把返回数据作为 Model 的属性 → 返回一个视图名 → 通过第三方的页面渲染把 Model 数据渲染到页面中 → 返回 HTML 页面</li><li>前后端分离：控制器返回一个 Java 对象，在方法上加 <code>@ResponseBody</code> 注解转化成 <code>json</code> 格式；或者在类的上方加注解 <code>@RestController</code></li></ul></li></ol><h1 id="Spring-Data-JDBC、JPA"><a href="#Spring-Data-JDBC、JPA" class="headerlink" title="Spring Data JDBC、JPA"></a><strong>Spring Data JDBC、JPA</strong></h1><table><thead><tr><th>特点</th><th>JdbcTemplate</th><th>Spring Data JDBC</th><th>JPA</th></tr></thead><tbody><tr><td>实现具体类</td><td>需要</td><td>不需要，只要写明继承关系</td><td>不需要，只要写明继承关系</td></tr><tr><td>定义实体类和数据库表的映射关系</td><td>不需要</td><td>需要</td><td>需要</td></tr><tr><td>程序员维护表之间的关系</td><td>需要</td><td>不需要</td><td>不需要</td></tr><tr><td>显式提供表结构（建表 SQL 脚本）</td><td>需要</td><td>需要</td><td>不需要，可以自动推断</td></tr></tbody></table><h2 id="使用-JdbcTemplate"><a href="#使用-JdbcTemplate" class="headerlink" title="使用 JdbcTemplate"></a>使用 JdbcTemplate</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>解决 <code>RawJdbcIngredientRepository</code> 样板式代码的问题，只需要提供查询逻辑</li><li>需要实现具体类 <code>JdbcIngredientRepository</code> 而其他两种方法不用</li><li>需要提供 <code>src/main/resources/schema.sql</code> 文件作为表结构的定义（建表脚本）</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcIngredientRepository</span> <span class="keyword">implements</span> <span class="title class_">IngredientRepository</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">JdbcIngredientRepository</span><span class="params">(JdbcTemplate jdbcTemplate)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Iterable&lt;Ingredient&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> jdbcTemplate.query(</span><br><span class="line">        <span class="string">&quot;select id, name, type from Ingredient&quot;</span>,</span><br><span class="line">        <span class="built_in">this</span>::mapRowToIngredient);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用-Spring-Data-JDBC"><a href="#使用-Spring-Data-JDBC" class="headerlink" title="使用 Spring Data JDBC"></a>使用 Spring Data JDBC</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>需要定义实体类和数据库表的映射关系</li><li>不需要实现具体类，只需要写好继承关系</li><li>需要提供 <code>src/main/resources/schema.sql</code> 文件作为表结构的定义（建表脚本）</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IngredientRepository</span> </span><br><span class="line">         <span class="keyword">extends</span> <span class="title class_">CrudRepository</span>&lt;Ingredient, String&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.annotation.Id;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Persistable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.relational.core.mapping.Table;</span><br><span class="line"><span class="comment">//Spring Data JDBC 的注解由 Spring 本身提供</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Table</span> <span class="comment">//可选，因为不需要借助类推断表结构</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor(access=AccessLevel.PRIVATE, force=true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ingredient</span> <span class="keyword">implements</span> <span class="title class_">Persistable</span>&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> Type type;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isNew</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Type</span> &#123;</span><br><span class="line">    WRAP, PROTEIN, VEGGIES, CHEESE, SAUCE</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用-Spring-Data-JPA"><a href="#使用-Spring-Data-JPA" class="headerlink" title="使用 Spring Data JPA"></a>使用 Spring Data JPA</h2><ul><li>JPA：Java Persistence API</li><li>JPA 的宗旨是为 POJO 提供持久化标准规范</li><li>JPQL 是一种面向对象的查询语言</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>需要定义实体类和数据库表的映射关系</li><li>不需要实现具体类，只需要写好继承关系</li><li>依据实体类推断表结构，不需要建表脚本</li><li>可以自定义查询方法</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IngredientRepository</span> </span><br><span class="line">         <span class="keyword">extends</span> <span class="title class_">CrudRepository</span>&lt;Ingredient, String&gt; &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="comment">//标准的包路径，JPA 规范；定义了很多接口，由不同厂家实现</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor(access=AccessLevel.PRIVATE, force=true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ingredient</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="keyword">private</span> String id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> Type type;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Type</span> &#123;</span><br><span class="line">    WRAP, PROTEIN, VEGGIES, CHEESE, SAUCE</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="自定义的查询方法"><a href="#自定义的查询方法" class="headerlink" title="自定义的查询方法"></a>自定义的查询方法</h2><ol><li><p>定义查询方法，无需实现</p><ul><li><p>领域特定语言（domain-specific language，DSL)，spring data的命名约定</p></li><li><p>查询动词 + 主题 + 断言</p></li><li><p>查询动词：get、read、find、count</p></li><li><p>例子：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;TacoOrder&gt; <span class="title function_">findByDeliveryZip</span><span class="params">( String deliveryZip )</span>;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>声明自定义查询</p><ul><li><p>不符合方法命名约定时，或者命名太长时</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Query(“Order o where o.deliveryCity = &#x27;Seattle&#x27;”)</span></span><br><span class="line">List&lt;TacoOrder&gt; <span class="title function_">readOrdersDeliveredInSeattle</span><span class="params">( )</span>;</span><br></pre></td></tr></table></figure></li></ul></li></ol><h2 id="Jpa、Hibernate、Spring-Data-Jpa-三者之间的关系"><a href="#Jpa、Hibernate、Spring-Data-Jpa-三者之间的关系" class="headerlink" title="Jpa、Hibernate、Spring Data Jpa 三者之间的关系"></a>Jpa、Hibernate、Spring Data Jpa 三者之间的关系</h2><ul><li>JPA 的宗旨是为 POJO 提供持久化标准规范</li><li>Hibernate 作为厂家实现了这一规范</li></ul><p><img src="/img/%E5%85%B3%E7%B3%BB.png" alt="关系"></p><h1 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a><strong>Spring Security</strong></h1><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="用户信息存储"><a href="#用户信息存储" class="headerlink" title="用户信息存储"></a>用户信息存储</h2><ul><li>内存用户存储</li><li>JDBC 用户存储</li><li>LDAP 用户存储</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="/img/%E6%80%BB%E7%BB%93.png" alt="总结"></p><ul><li><p>保护 web 请求</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityFilterChain <span class="title function_">filterChain</span><span class="params">(HttpSecurity http)</span></span><br></pre></td></tr></table></figure><p>权限管理</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http</span><br><span class="line">      .authorizeRequests()</span><br><span class="line">        .antMatchers(<span class="string">&quot;/design&quot;</span>, <span class="string">&quot;/orders&quot;</span>).access(<span class="string">&quot;hasRole(&#x27;USER&#x27;)&quot;</span>)</span><br><span class="line">        .antMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/**&quot;</span>).access(<span class="string">&quot;permitAll&quot;</span>)</span><br><span class="line"></span><br><span class="line">      .and()</span><br><span class="line">        .formLogin()</span><br><span class="line">          .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line"></span><br><span class="line">      .and()</span><br><span class="line">        .logout()</span><br><span class="line">          .logoutSuccessUrl(<span class="string">&quot;/&quot;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Make H2-Console non-secured; for debug purposes</span></span><br><span class="line">      .and()</span><br><span class="line">        .csrf()</span><br><span class="line">          .ignoringAntMatchers(<span class="string">&quot;/h2-console/**&quot;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Allow pages to be loaded in frames from the same origin; needed for H2-Console</span></span><br><span class="line">      .and()</span><br><span class="line">        .headers()</span><br><span class="line">          .frameOptions()</span><br><span class="line">            .sameOrigin()</span><br><span class="line">      ;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li><li><p>创建自定义登录页</p><ul><li>当需要认证时转向的登录页：<code>.loginPage(&quot;/login&quot;)</code></li><li>视图控制器，定义 login 请求对应的视图：<code>registry.addViewController(&quot;/login&quot;);</code></li><li>登录的 post 请求由 Spring Security 自动处理，名称默认：<code>username</code>、<code>password</code>，可配置</li></ul></li></ul><h1 id="Docker使用"><a href="#Docker使用" class="headerlink" title="Docker使用"></a><strong>Docker使用</strong></h1><h2 id="docker-run命令"><a href="#docker-run命令" class="headerlink" title="docker run命令"></a>docker run命令</h2><ul><li><strong><code>-d</code>：后台运行容器，并返回容器 ID</strong></li><li><code>-i</code>：以交互模式运行容器，通常与 <code>-t</code> 同时使用</li><li><code>-t</code>：为容器重新分配一个伪输入终端，通常与 <code>-i</code> 同时使用</li><li><strong><code>-p</code>：指定（发布）端口映射，格式为：<code>主机（宿主）端口 : 容器端口</code></strong></li><li><code>-P</code>：随机端口映射，容器内部端口随机映射到主机的高端口</li><li><code>--name=&quot;nginx-lb&quot;</code>：为容器指定一个名称</li><li><strong><code>-e username=&quot;ritchie&quot;</code>：设置环境变量</strong></li><li><code>--env-file=c:/temp1/t1.txt</code>：从指定文件读入环境变量</li><li><code>--expose=2000-2002</code>：开放（暴露）一个端口或一组端口；</li><li><code>--link my-mysql:taozs</code>：添加链接到另一个容器</li><li><code>-v c:/temp1:/data</code>：绑定一个卷（volume）</li><li><strong><code>--rm</code> 退出时自动删除容器</strong></li><li>其他命令：cat &#x2F;etc&#x2F;hosts：查看当前容器 IP 地址</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker --<span class="built_in">help</span></span></span><br><span class="line"></span><br><span class="line">Management Commands:</span><br><span class="line">  builder     Manage builds</span><br><span class="line">  buildx*     Docker Buildx (Docker Inc., v0.10.3)</span><br><span class="line">  compose*    Docker Compose (Docker Inc., v2.15.1)</span><br><span class="line">  config      Manage Docker configs</span><br><span class="line">  container   Manage containers</span><br><span class="line">  context     Manage contexts</span><br><span class="line">  dev*        Docker Dev Environments (Docker Inc., v0.1.0)</span><br><span class="line">  extension*  Manages Docker extensions (Docker Inc., v0.2.18)</span><br><span class="line">  image       Manage images</span><br><span class="line">  manifest    Manage Docker image manifests and manifest lists</span><br><span class="line">  network     Manage networks</span><br><span class="line">  node        Manage Swarm nodes</span><br><span class="line">  plugin      Manage plugins</span><br><span class="line">  sbom*       View the packaged-based Software Bill Of Materials (SBOM) for an image (Anchore Inc., 0.6.0)</span><br><span class="line">  scan*       Docker Scan (Docker Inc., v0.25.0)</span><br><span class="line">  scout*      Command line tool for Docker Scout (Docker Inc., v0.6.0)</span><br><span class="line">  secret      Manage Docker secrets</span><br><span class="line">  service     Manage services</span><br><span class="line">  stack       Manage Docker stacks</span><br><span class="line">  swarm       Manage Swarm</span><br><span class="line">  system      Manage Docker</span><br><span class="line">  trust       Manage trust on Docker images</span><br><span class="line">  volume      Manage volumes</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">管理命令可以管理 volume、network、container、image</span></span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  attach      Attach local standard input, output, and error streams to a running container</span><br><span class="line">  build       Build an image from a Dockerfile</span><br><span class="line">  commit      Create a new image from a container&#x27;s changes</span><br><span class="line">  cp          Copy files/folders between a container and the local filesystem</span><br><span class="line">  create      Create a new container</span><br><span class="line">  diff        Inspect changes to files or directories on a container&#x27;s filesystem</span><br><span class="line">  events      Get real time events from the server</span><br><span class="line">  exec        Run a command in a running container</span><br><span class="line">  export      Export a container&#x27;s filesystem as a tar archive</span><br><span class="line">  history     Show the history of an image</span><br><span class="line">  images      List images</span><br><span class="line">  import      Import the contents from a tarball to create a filesystem image</span><br><span class="line">  info        Display system-wide information</span><br><span class="line">  inspect     Return low-level information on Docker objects</span><br><span class="line">  kill        Kill one or more running containers</span><br><span class="line">  load        Load an image from a tar archive or STDIN</span><br><span class="line">  login       Log in to a Docker registry</span><br><span class="line">  logout      Log out from a Docker registry</span><br><span class="line">  logs        Fetch the logs of a container</span><br><span class="line">  pause       Pause all processes within one or more containers</span><br><span class="line">  port        List port mappings or a specific mapping for the container</span><br><span class="line">  ps          List containers</span><br><span class="line">  pull        Pull an image or a repository from a registry</span><br><span class="line">  push        Push an image or a repository to a registry</span><br><span class="line">  rename      Rename a container</span><br><span class="line">  restart     Restart one or more containers</span><br><span class="line">  rm          Remove one or more containers</span><br><span class="line">  rmi         Remove one or more images</span><br><span class="line">  run         Run a command in a new container</span><br><span class="line">  save        Save one or more images to a tar archive (streamed to STDOUT by default)</span><br><span class="line">  search      Search the Docker Hub for images</span><br><span class="line">  start       Start one or more stopped containers</span><br><span class="line">  stats       Display a live stream of container(s) resource usage statistics</span><br><span class="line">  stop        Stop one or more running containers</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停止运行容器</span></span><br><span class="line">  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span><br><span class="line">  top         Display the running processes of a container</span><br><span class="line">  unpause     Unpause all processes within one or more containers</span><br><span class="line">  update      Update configuration of one or more containers</span><br><span class="line">  version     Show the Docker version information</span><br><span class="line">  wait        Block until one or more containers stop, then print their exit codes</span><br></pre></td></tr></table></figure><h1 id="容器镜像构建与编排"><a href="#容器镜像构建与编排" class="headerlink" title="容器镜像构建与编排"></a><strong>容器镜像构建与编排</strong></h1><h2 id="Dockerfile文件的指令"><a href="#Dockerfile文件的指令" class="headerlink" title="Dockerfile文件的指令"></a>Dockerfile文件的指令</h2><ul><li><strong><code>FROM</code> ：指定基础镜像，必须为第一个命令</strong></li><li><strong><code>RUN</code> ：构建镜像时执行的命令</strong></li><li><strong><code>ADD</code> ：将本地文件添加到容器中 tar 类型文件会自动解压</strong></li><li><strong><code>COPY</code> ：功能类似 ADD ，但是不会自动解压文件</strong></li><li><strong><code>CMD</code> ：构建容器后调用，也就是在容器启动时才进行调用</strong></li><li><strong><code>ENTRYPOINT</code> ：配置容器，使其可执行化。配合 CMD 可省去 “ application”，只使用参数，用于 docker run 时根据不同参数执行不同功能</strong></li><li><code>LABEL</code> ：用于为镜像添加元数据</li><li><code>ENV</code> ：设置环境变量</li><li><code>EXPOSE</code> ：指定与外界交互的端口，容器内的端口号 docker run 时加 P 则会映射一个随机号（宿主机）</li><li><code>VOLUME</code> ：用于指定持久化目录 docker run 时如果没有指定挂载目录，会创建一个 volume</li><li><code>WORKDIR</code> ：工作目录，类似于 cd 命令</li><li><code>USER</code> ：指定 运行容器时的用户名或 UID</li><li><code>ARG</code> ：用于指定传递给构建运行时的变量</li><li><code>ONBUILD</code> ：用于设置镜像触发器</li></ul><p>注意：<code>ADD</code> 和 <code>COPY</code> 的区别；<code>CMD</code> 和 <code>ENTRYPOINT</code> 不可以互相替代</p><h2 id="Docker-build"><a href="#Docker-build" class="headerlink" title="Docker build"></a>Docker build</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker build [OPTIONS] PATH | URL | -</span><br></pre></td></tr></table></figure><p>如何编写最佳的 Dockerfile：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/26904830">https://zhuanlan.zhihu.com/p/26904830</a></p><ul><li><code>.dockerignore</code> 文件（构建镜像时排除一些不需要的文件）</li><li>容器只运行单个应用（多个应用不利于管理）</li><li>将多个 <code>RUN</code> 指令合并为一个（镜像是分层的，将相似变化频率的镜像放在一起）</li><li>基础镜像的标签不要用 <code>latest</code></li><li>每个 <code>RUN</code> 指令后删除多余文件</li><li>选择合适的基础镜像（alpine 版本最好）</li><li>设置 <code>WORKDIR</code> 和 <code>CMD</code></li><li>Docker 健康检查 HEALTHCHECK 的使用方法：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/386986915">https://zhuanlan.zhihu.com/p/386986915</a></li></ul><h2 id="服务编排工具，docker-compose"><a href="#服务编排工具，docker-compose" class="headerlink" title="服务编排工具，docker-compose"></a>服务编排工具，docker-compose</h2><ul><li><p>Compose 项目是 Docker 官方的开源项目，负责实现对 Docker 容器集群的快速编排</p></li><li><p>一个单独的 docker compose.yml 模板文件（ YAML 格式）来定义一组相关联的应用容器为一个项目（project）</p></li><li><p>Compose 的默认管理对象是项目，通过子命令对项目中的一组容器进行便捷地生命周期管理</p></li><li><p>Compose 中有两个重要的概念：</p><ul><li>服务（service）：一个应用的容器（可能会有多个容器），实际上可以包括若干运行相同镜像的容器实例</li><li>项目（project）：由一组关联的应用容器组成的一个完整业务单元，在 <code>docker.compose.yml</code> 文件中定义</li></ul></li><li><p>使用微服务架构的系统一般包含若干个微服务，每个微服务一般部署多个实例。如果每个服务都要手动启停，那么效率低，维护量大</p></li></ul><h2 id="YAML-文件"><a href="#YAML-文件" class="headerlink" title="YAML 文件"></a>YAML 文件</h2><ol><li><p>使用缩进表示层级关系，不允许使用 Tab 键，只允许使用空格</p></li><li><p><code>#</code> 表示注释，从这个字符一直到行尾，都会被解析器忽略。</p></li><li><p>对象，键值对，使用冒号结构表示</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">animal:</span> <span class="string">pets</span></span><br><span class="line"><span class="attr">hash:</span> &#123; <span class="attr">name:</span> <span class="string">Steve</span>, <span class="attr">foo:</span> <span class="string">bar</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>数组，一组连词线开头的行，构成一个数组</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">Cat</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">Dog</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">Goldfish</span></span><br><span class="line"><span class="comment">#行内表示法： </span></span><br><span class="line"><span class="attr">animal:</span> [<span class="string">Cat</span>, <span class="string">Dog</span>]</span><br></pre></td></tr></table></figure></li></ol><h2 id="docker-compose常用命令"><a href="#docker-compose常用命令" class="headerlink" title="docker-compose常用命令"></a>docker-compose常用命令</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">## docker-compose常用命令</span><br><span class="line"></span><br><span class="line">​```bash</span><br><span class="line">docker-compose --help</span><br><span class="line">提到：docker-compose up -d # 该命令十分强大，它将尝试自动完成包括构建镜像，（重新）创建服务，启动服务，并关联服务相关容器的一系列操作</span><br><span class="line">提到：docker-compose ps # 呈现刚才部署的项目下的容器，而不是所有的容器</span><br><span class="line">提到：docker-compose ps --services</span><br><span class="line">提到：docker-compose images # 呈现刚才部署的项目下的镜像，而不是所有的容器</span><br><span class="line">docker-compose stop # 终止整个服务集合</span><br><span class="line">docker-compose stop nginx # 终止指定的服务 （这有个点就是启动的时候会先启动 depond_on 中的容器，关闭的时候不会影响到 depond_on 中的）</span><br><span class="line">提到：docker-compose logs -f [services...] # 查看容器的输出日志</span><br><span class="line">docker-compose build [SERVICE...]</span><br><span class="line">docker-compose rm nginx # 移除指定的容器</span><br><span class="line">docker-compose up -d --scale flask=3 organizationservice=2 # 设置指定服务运行的容器个数</span><br></pre></td></tr></table></figure><h1 id="k8s使用"><a href="#k8s使用" class="headerlink" title="k8s使用"></a><strong>k8s使用</strong></h1><h2 id="k8s中的资源"><a href="#k8s中的资源" class="headerlink" title="k8s中的资源"></a>k8s中的资源</h2><ul><li>namespaces</li><li><strong>Pods</strong></li><li>ReplicaSet</li><li><strong>Deployment</strong></li><li><strong>Service</strong></li><li><strong>Ingress</strong></li><li>configmap</li><li>secrets</li><li>serviceaccounts</li><li>DaemonSetf</li></ul><h2 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h2><ul><li><p>Pod 是 Kubernetes 调度的最小单元</p></li><li><p>一个 Pod 可以包含一个或多个容器，因此它可以被看作是内部容器的逻辑宿主机。Pod 的设计理念是为了支持多个容器在一个 Pod 中共享网络和文件系统。</p><ul><li>PID 命名空间： Pod 中不同的应用程序可以看到其他应用程序的进程 ID</li><li>network 命名空间： Pod 中多个容器处于同一个网络命名空间，因此能够访问的 IP 和端口范围都是相同的。也可以通过 localhost 相互访问</li><li>IPC 命名空间： Pod 中的多个容器共享 Inner process Communication 命名空间，因此可以通过 SystemV IPC 或 POSIX 进行进程间通信</li><li>UTS 命名空间： Pod 中的多个容器共享同一个主机名</li><li>Volumes Pod 中各个容器可以共享在 Pod 中定义分存储卷（Volume）</li></ul></li><li><p>如何将pod或service的端口快速映射到本机端口（调试用）</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl port-forward pod/myspittr 8081:8080</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">访问：http://localhost:8081/spittr/</span></span><br><span class="line">kubectl port-forward service/demo 8081:80</span><br></pre></td></tr></table></figure></li><li><p>创建服务</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl expose pod myspittr --port 8080</span><br><span class="line">kubectl get svc</span><br><span class="line">kubectl delete service myspittr</span><br></pre></td></tr></table></figure></li><li><p>创建ingress</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl create ingress myspittr --class=nginx --rule=www.demo.com/*=myspittr:8080</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">访问：http://www.demo.com/spittr/</span></span><br><span class="line">kubectl delete ingress myspittr</span><br><span class="line">kubectl run -i -t --rm=true mycurl --image=curlimages/curl:latest --restart=Never --command --sh</span><br></pre></td></tr></table></figure></li></ul><h2 id="Label、Service-和-Pod-之间的关系"><a href="#Label、Service-和-Pod-之间的关系" class="headerlink" title="Label、Service 和 Pod 之间的关系"></a>Label、Service 和 Pod 之间的关系</h2><p><img src="/img/%E4%B8%89%E8%80%85%E5%85%B3%E7%B3%BB.png" alt="三者关系"></p><ul><li><strong>服务的三种可访问方式：服务名；服务集群 IP；Pod IP</strong></li><li><strong>Pod名不可访问</strong></li></ul><h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><ul><li><p>更新镜像重部署</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl set image deployment/spittr spittr=spittr:1.0</span><br></pre></td></tr></table></figure></li><li><p>扩容</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl scale deployment spittr --replicas 2</span><br></pre></td></tr></table></figure></li><li><p>自动伸缩</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl autoscale deployment spittr --min=10 --max=15 --cpu-percent=80</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">控制伸缩的个数区间</span></span><br></pre></td></tr></table></figure></li><li><p>查看历史版本</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl rollout history deployment/spittr</span><br></pre></td></tr></table></figure></li><li><p>回滚到前一个版本</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl rollout undo deployment/spittr</span><br></pre></td></tr></table></figure></li></ul><h2 id="K8s-Service-和-Nacos-Service-的异同点"><a href="#K8s-Service-和-Nacos-Service-的异同点" class="headerlink" title="K8s Service 和 Nacos Service 的异同点"></a>K8s Service 和 Nacos Service 的异同点</h2><ul><li>共同点：通过服务名访问多个服务</li><li>不同点：<ul><li>K8s 的服务是 Pod 层级的，它与 K8s 的其他资源（Ingress，Pod）是配合使用的</li><li>Nacos 的服务是服务层级的，与开发框架相关</li><li>可以二选一</li><li>服务的部署、升级、重启等还是需要借助于底层的 K8s</li></ul></li></ul><h1 id="REST服务、微服务开发与部署"><a href="#REST服务、微服务开发与部署" class="headerlink" title="REST服务、微服务开发与部署"></a><strong>REST服务、微服务开发与部署</strong></h1><h2 id="单体应用程序"><a href="#单体应用程序" class="headerlink" title="单体应用程序"></a>单体应用程序</h2><ul><li>数据库的表对所有模块可见</li><li>一个人的修改整个应用都要重新构建、测试、部署</li><li>整体复制分布式部署，不能拆分按需部署</li></ul><h2 id="微服务架构模式的特征"><a href="#微服务架构模式的特征" class="headerlink" title="微服务架构模式的特征"></a>微服务架构模式的特征</h2><ul><li>应用程序分解为具有明确定义了职责范围的细粒度组件</li><li>完全独立部署，独立测试，并可复用</li><li>使用轻量级通信协议，HTTP 和 JSON，松耦合</li><li>服务实现可使用多种编程语言和技术</li><li>将大型团队划分成多个小型开发团队，每个团队只负责他们各自的服务</li></ul><h2 id="响应头与响应体"><a href="#响应头与响应体" class="headerlink" title="响应头与响应体"></a>响应头与响应体</h2><p>状态行：由 HTTP 协议版本、状态码、状态码描述三部分构成，它们之间由空格隔开。</p><p><strong>状态码</strong>：由 3 位数字组成，第一位标识响应的类型，常用的 5 大类状态码如下：</p><ul><li>1xx ：表示服务器已接收了客户端的请求，客户端可以继续发送请求</li><li>2xx ：表示服务器已成功接收到请求并进行处理</li><li>3xx ：表示服务器要求客户端重定向</li><li>4xx ：表示客户端的请求有非法内容</li><li>5xx ：标识服务器未能正常处理客户端的请求而出现意外错误</li></ul><p>响应头：</p><ul><li>Location ：服务器返回给客户端，用于重定向到新的位置</li><li>Server 包含服务器用来处理请求的软件信息及版本信息 Vary ：标识不可缓存的请求头列表</li><li>Connection: 连接方式， close 是告诉服务端，断开连接，不用等待后续的请求了。 keep alive 则是告诉服务端，在完成本次请求的响应后，保持连接</li><li>Keep Alive: 300 ，期望服务端保持连接多长时间（秒）</li></ul><p>响应内容：服务端返回给请求端的文本信息。</p><h2 id="消息转换器（Message-conversion）"><a href="#消息转换器（Message-conversion）" class="headerlink" title="消息转换器（Message conversion）"></a>消息转换器（Message conversion）</h2><ul><li><strong>使用注解 <code>@ResponseBody</code> 或类级 <code>@RestController</code> 作用：指定使用消息转换器，把 Java 对象转化成 json 文件</strong></li><li>没有 model 和视图 控制器产生数据 然后消息转换器转换数据之后的资源表述 。</li><li>spring 自动注册一些消息转换器（HttpMethodConverter）不过类路径下要有对应转换能力的库 如：Jackson Json processor、JAXB 库</li><li><strong>请求传入， <code>@RequestBody</code> 以及 HttpMethodConverter，把来自客户端的 json 数据转化成 Java 对象</strong>。</li></ul><h2 id="例子代码"><a href="#例子代码" class="headerlink" title="例子代码"></a>例子代码</h2><ul><li><code>@SpringBootApplication</code><ul><li>配置类 <code>@Configuration</code></li><li><code>@ComponentScan</code></li></ul></li><li><code>@RestController</code><ul><li><code>@Controller</code></li><li>请求响应，JSON 编解码（序列化）</li></ul></li><li>健康检查<ul><li>添加 actuator 依赖，可以获取很多端点，如 health</li></ul></li></ul><h2 id="运维实践"><a href="#运维实践" class="headerlink" title="运维实践"></a>运维实践</h2><ul><li>代码和测试脚本等都在源代码库中</li><li>指定 JAR 依赖的版本号</li><li>配置与源代码分开放，配置当中有很多常变化的、敏感的信息</li><li>已构建的服务是不可变的，不能再被修改</li><li>微服务应该是无状态的</li><li>并发，通过启动更多的微服务实例横向扩展，多线程是纵向扩展</li></ul><h1 id="基于NACOS的数据配置"><a href="#基于NACOS的数据配置" class="headerlink" title="基于NACOS的数据配置"></a><strong>基于NACOS的数据配置</strong></h1><h2 id="微服务开发配置"><a href="#微服务开发配置" class="headerlink" title="微服务开发配置"></a>微服务开发配置</h2><ol><li><p>添加依赖</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在 bootstrap 中定义 nacos 访问地址，以及可能的文件后缀（yml、properties）、服务名</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">licensingservice</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span></span><br><span class="line">      <span class="string">default</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">nacos-headless:8848</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="attr">show-details:</span> <span class="string">always</span></span><br></pre></td></tr></table></figure></li><li><p><code>@Value</code> 指定要获取的属性名</p><p><code>@RefreshScope</code> 实时刷新，可以获取到来自 nacos 的最新修改</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RefreshScope</span> <span class="comment">// nacos 变更后微服务可以及时获取最新数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;example.property&#125;&quot;)</span> <span class="comment">// 指定 key 名，从 nacos 获得属性值</span></span><br><span class="line">	<span class="keyword">private</span> String exampleProperty;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getExampleProperty</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> exampleProperty;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="dataId-的完整格式"><a href="#dataId-的完整格式" class="headerlink" title="dataId 的完整格式"></a>dataId 的完整格式</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$&#123;prefix&#125;-$&#123;spring.profiles.active&#125;.$&#123;file-extension&#125;</span><br></pre></td></tr></table></figure><p><code>prefix</code> 默认为 <code>spring.application.name</code> 的值，也可以通过配置项 <code>spring.cloud.nacos.config.prefix</code> 来配置 <code>spring.profiles.active</code> 即为当前环境对应的 <code>profile</code>。</p><p><code>file-exetension</code> 为配置内容的数据格式，可以通过配置项 <code>spring.cloud.nacos.config.file-extension</code> 来配置。 目前只支持 <code>properties</code> 和 <code>yaml</code> 类型。</p><h1 id="基于NACOS的服务注册与发现"><a href="#基于NACOS的服务注册与发现" class="headerlink" title="基于NACOS的服务注册与发现"></a><strong>基于NACOS的服务注册与发现</strong></h1><h2 id="服务发现的好处"><a href="#服务发现的好处" class="headerlink" title="服务发现的好处"></a>服务发现的好处</h2><ul><li>快速水平伸缩，而不是垂直伸缩。不影响客户端</li><li>提高应用程序的弹性</li></ul><h2 id="Spring-Cloud-Alibaba"><a href="#Spring-Cloud-Alibaba" class="headerlink" title="Spring Cloud Alibaba"></a>Spring Cloud Alibaba</h2><p><img src="/img/SpringCloudAlibaba.png" alt="Spring Cloud Alibaba"></p><h2 id="使用到的starter依赖"><a href="#使用到的starter依赖" class="headerlink" title="使用到的starter依赖"></a>使用到的starter依赖</h2><ul><li>服务配置： <code>com.alibaba.cloud, spring-cloud-starter-alibaba-nacos-config</code></li><li>服务注册： <code>com.alibaba.cloud, spring-cloud-starter-alibaba-nacos-discovery</code></li><li>客户端负载均衡： <code>org.springframework.cloud, spring-cloud-starter-loadbalancer</code></li><li>简化客户端调用： <code>org.springframework.cloud, spring-cloud-starter-openfeign</code></li></ul><h2 id="调用服务的三种方式"><a href="#调用服务的三种方式" class="headerlink" title="调用服务的三种方式"></a>调用服务的三种方式</h2><ol><li>Spring DiscoveryClient</li><li>使用支持 LoadBalanced 的 RestTemplate</li><li>使用 OpenFeign （@FeignClient）：OpenFeign 是一款声明式、模板化的 HTTP 客户端， Feign 可以帮助我们更快捷、优雅地调用 HTTP API</li></ol><p>后两种方法自动做负载均衡，因此一般不建议使用第一种（只在测试时使用），更常见的是第三种。我们定义的负载平衡策略（轮询、随机等）能影响到后两种方式。</p><h2 id="健康检查"><a href="#健康检查" class="headerlink" title="健康检查"></a>健康检查</h2><ul><li>临时实例的客户端主动上报机制， 临时实例每隔 5s 发送一个心跳包给 Nacos 服务器 端<ul><li>学习参考（源码剖析）：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/386647120">https://zhuanlan.zhihu.com/p/386647120</a></li><li>客户端调用如何应对服务状态不能及时更新，请参考学习：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/fDtcQD1EL-NgVV1BMiPx4g">https://mp.weixin.qq.com/s/fDtcQD1EL-NgVV1BMiPx4g</a></li></ul></li><li>永久实例的服务端反向探测机制，永久实例支持 3 种探测协议，TCP、HTTP 和 MySQL，默认探测协议为 TCP 也就是通过不断 ping 的方式来判断实例是否健康 。</li><li>两种健康检查机制的学习参考：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/473494621">https://zhuanlan.zhihu.com/p/473494621</a></li></ul><p><img src="/img/%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5.png" alt="健康检查"></p><h2 id="服务部署"><a href="#服务部署" class="headerlink" title="服务部署"></a>服务部署</h2><p><img src="/img/%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2.png" alt="服务部署"></p><p>由 A 到 B，需要获得 B 的 IP 地址和端口号。不是 A 先把请求发给 Nacos，由 Nacos 进行转发，而是从 Nacos 获得 IP 地址，再直接和 B 进行通信。</p><h2 id="如何使用-Nacos-实现服务注册与发现"><a href="#如何使用-Nacos-实现服务注册与发现" class="headerlink" title="如何使用 Nacos 实现服务注册与发现"></a>如何使用 Nacos 实现服务注册与发现</h2><ol><li><p>添加依赖</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2021.0.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">简化客户端调用</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">服务注册</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">服务配置</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">客户端负载均衡</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>   </span><br></pre></td></tr></table></figure></li><li><p>在 bootstrap 中定义 nacos 访问机制</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">organizationservice</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span></span><br><span class="line">      <span class="string">default</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">nacos-headless:8848</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yml</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">nacos-headless:8848</span></span><br></pre></td></tr></table></figure></li><li><p>启动类中添加注解</p><ul><li><code>@EnableDiscoveryClient</code></li><li><code>@EnableFeignClients</code></li><li><code>@LoadBalanced</code></li></ul></li><li><p>调用服务的方式（第三种：使用 OpenFeign <code>@FeignClient</code>）</p><p>实现接口</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;organizationservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrganizationFeignClient</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(</span></span><br><span class="line"><span class="meta">            method= RequestMethod.GET,</span></span><br><span class="line"><span class="meta">            value=&quot;/v1/organizations/&#123;organizationId&#125;&quot;,</span></span><br><span class="line"><span class="meta">            consumes=&quot;application/json&quot;)</span></span><br><span class="line">    Organization <span class="title function_">getOrganization</span><span class="params">(<span class="meta">@PathVariable(&quot;organizationId&quot;)</span> String organizationId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将接口注入服务并调用</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LicenseService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OrganizationFeignClient organizationFeignClient;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="基于Sentinel的流控与熔断"><a href="#基于Sentinel的流控与熔断" class="headerlink" title="基于Sentinel的流控与熔断"></a><strong>基于Sentinel的流控与熔断</strong></h1><h2 id="定义资源的方式"><a href="#定义资源的方式" class="headerlink" title="定义资源的方式"></a>定义资源的方式</h2><ol><li>代码直接定义</li><li>使用注解定义</li><li>Spring Cloud 针对 URL 自动定义</li></ol><p><strong>强调：外置文件只能用来定义规则，不能用来定义资源</strong></p><h2 id="规则的种类"><a href="#规则的种类" class="headerlink" title="规则的种类"></a>规则的种类</h2><ul><li>流量控制规则</li><li>熔断降级规则</li><li>系统保护规则</li><li>来源访问控制规则</li><li>热点参数规则</li></ul><h2 id="熔断策略"><a href="#熔断策略" class="headerlink" title="熔断策略"></a>熔断策略</h2><ul><li>慢调用比例</li><li>异常比例</li><li>异常数</li></ul><h2 id="Sentinel组成"><a href="#Sentinel组成" class="headerlink" title="Sentinel组成"></a>Sentinel组成</h2><ul><li>核心库（Java 客户端）：不依赖任何框架&#x2F;库，能够运行于 Java 8 及以上的版本的运行时环境，同时对 Dubbo&#x2F;Spring Cloud 等框架也有较好的支持</li><li>控制台（Dashboard Dashboard）：主要负责管理推送规则、监控、管理机器信息等</li></ul><p><img src="/img/sentinel.png" alt="sentinel"></p><p><strong>控制台不维护规则，通过端口号 8719 查询规则，如果服务故障则规则丢失。</strong></p><h1 id="往年简答题"><a href="#往年简答题" class="headerlink" title="往年简答题"></a>往年简答题</h1><h2 id="WEB-MVC-分层"><a href="#WEB-MVC-分层" class="headerlink" title="WEB MVC 分层"></a>WEB MVC 分层</h2><ul><li>模型（Model）代表数据控制器。数据的读取，插入，更新都是由模型来负责。</li><li>视图（View）是展示给用户的最终页面。视图负责将数据以用户友好的形式展现出来。</li><li>控制器（Controller）是模型，视图以及其他任何处理 HTTP 请求所必须的资源之前的中介</li></ul><p><strong>处理流程</strong></p><ul><li>控制器最先被调用，并被赋予外部输入</li><li>控制器根据外部输入向模型请求数据</li><li>模型从数据库获取数据并发送数据到控制器</li><li>控制器处理该数据并发送封装好的数据到视图</li><li>视图根据接到的数据最终展示页面给用户浏览</li></ul><h2 id="微服务相比于传统的单体业务有什么优势，为何关注微服务，有什么典型特征，单体有什么不足"><a href="#微服务相比于传统的单体业务有什么优势，为何关注微服务，有什么典型特征，单体有什么不足" class="headerlink" title="微服务相比于传统的单体业务有什么优势，为何关注微服务，有什么典型特征，单体有什么不足"></a>微服务相比于传统的单体业务有什么优势，为何关注微服务，有什么典型特征，单体有什么不足</h2><p><strong>优势</strong>：</p><ul><li>易于开发与维护</li><li>独立部署</li><li>伸缩性强</li><li>与组织结构相匹配</li></ul><p><strong>为何关注微服务</strong>：</p><ul><li>多人开发一个模块&#x2F;项目，提交代码频繁出现大量冲突。</li><li>模块间严重耦合，互相依赖，每次变动需要牵扯多个团队，单次上线需求太多，风险大。</li><li>主要业务和次要业务耦合，横向扩展流程复杂。</li></ul><p><strong>微服务典型特征</strong>：</p><ul><li>应用程序分解为具有明确定义了职责范围的细粒度组件</li><li>完全独立部署，独立测试，并可复用</li><li>使用轻量级通信协议，HTTP 和 JSON，松耦合</li><li>服务实现可使用多种编程语言和技术</li><li>将大型团队划分成多个小型开发团队，每个团队只负责他们各自的服务</li></ul><p><strong>单体应用程序的不足</strong>：</p><ul><li>数据库的表对所有模块可见</li><li>一个人的修改整个应用都要重新构建、测试、部署</li><li>整体复制分布式部署，不能拆分按需部署</li></ul><h2 id="服务注册与发现的好处"><a href="#服务注册与发现的好处" class="headerlink" title="服务注册与发现的好处"></a>服务注册与发现的好处</h2><p><strong>好处</strong>：</p><ul><li>快速水平伸缩，而不是垂直伸缩。不影响客户端</li><li>提高应用程序的弹性</li></ul><p><strong>部分文字参考熊佬博客：<a target="_blank" rel="noopener" href="https://eaglebear2002.github.io/2023Spring-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91-%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/">服务端开发-期末复习 | EagleBear2002 的博客</a></strong></p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="http://example.com">REHE</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="http://example.com/2023/04/08/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91%E5%A4%8D%E4%B9%A0/">http://example.com/2023/04/08/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91%E5%A4%8D%E4%B9%A0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">REHE's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%A4%8D%E4%B9%A0/">复习</a><a class="post-meta__tags" href="/tags/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/">服务端开发</a></div><div class="post_share"><div class="social-share" data-image="/img/fuwu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/04/08/%E9%9D%A2%E5%90%91%E6%9C%8D%E5%8A%A1%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E5%A4%8D%E4%B9%A0/" title="面向服务的软件工程复习"><img class="cover" src="/img/flower.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">面向服务的软件工程复习</div></div></a></div><div class="next-post pull-right"><a href="/2023/03/20/hello-myBlog/" title="Hello My Blog"><img class="cover" src="/img/yinghua.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Hello My Blog</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/06/19/SOA%E5%A4%8D%E4%B9%A0/" title="SOA复习"><img class="cover" src="/img/SAO.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-19</div><div class="title">SOA复习</div></div></a></div><div><a href="/2023/04/08/%E9%9D%A2%E5%90%91%E6%9C%8D%E5%8A%A1%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E5%A4%8D%E4%B9%A0/" title="面向服务的软件工程复习"><img class="cover" src="/img/flower.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-08</div><div class="title">面向服务的软件工程复习</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">REHE</div><div class="author-info__description">诗酒趁年华</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/REHE-web"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/REHE-web" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:rehe_jiang@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-number">1.</span> <span class="toc-text">建立开发环境</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96"><span class="toc-number">1.1.</span> <span class="toc-text">依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">源代码仓库管理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-number">2.</span> <span class="toc-text">依赖注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF"><span class="toc-number">2.1.</span> <span class="toc-text">核心技术</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-%E7%9A%84%E6%A0%B8%E5%BF%83%E6%98%AF%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E4%B8%AA%E5%AE%B9%E5%99%A8%EF%BC%88container%EF%BC%89"><span class="toc-number">2.2.</span> <span class="toc-text">Spring 的核心是提供了一个容器（container）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-%E9%85%8D%E7%BD%AE%E6%96%B9%E6%A1%88"><span class="toc-number">2.3.</span> <span class="toc-text">Spring 配置方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bean-%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">2.4.</span> <span class="toc-text">Bean 的作用域</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AOP-%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">AOP 面向切面编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP%E6%9C%AF%E8%AF%AD"><span class="toc-number">3.1.</span> <span class="toc-text">AOP术语</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AspectJ-%E5%88%87%E7%82%B9%E6%8C%87%E7%A4%BA%E5%99%A8%EF%BC%88pointcut-designator%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">AspectJ 切点指示器（pointcut designator）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6%EF%BC%88Web-MVC%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">Web开发框架（Web MVC）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Lombok"><span class="toc-number">4.1.</span> <span class="toc-text">Lombok</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-MVC%E7%9A%84%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84%E6%B3%A8%E8%A7%A3"><span class="toc-number">4.2.</span> <span class="toc-text">Spring MVC的请求映射注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Web-%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6%E7%9A%84%E5%88%86%E5%B1%82"><span class="toc-number">4.3.</span> <span class="toc-text">Spring Web 开发框架的分层</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Data-JDBC%E3%80%81JPA"><span class="toc-number">5.</span> <span class="toc-text">Spring Data JDBC、JPA</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-JdbcTemplate"><span class="toc-number">5.1.</span> <span class="toc-text">使用 JdbcTemplate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Spring-Data-JDBC"><span class="toc-number">5.2.</span> <span class="toc-text">使用 Spring Data JDBC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Spring-Data-JPA"><span class="toc-number">5.3.</span> <span class="toc-text">使用 Spring Data JPA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E6%9F%A5%E8%AF%A2%E6%96%B9%E6%B3%95"><span class="toc-number">5.4.</span> <span class="toc-text">自定义的查询方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jpa%E3%80%81Hibernate%E3%80%81Spring-Data-Jpa-%E4%B8%89%E8%80%85%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">5.5.</span> <span class="toc-text">Jpa、Hibernate、Spring Data Jpa 三者之间的关系</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Security"><span class="toc-number">6.</span> <span class="toc-text">Spring Security</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E5%AD%98%E5%82%A8"><span class="toc-number">6.1.</span> <span class="toc-text">用户信息存储</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">6.2.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E4%BD%BF%E7%94%A8"><span class="toc-number">7.</span> <span class="toc-text">Docker使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-run%E5%91%BD%E4%BB%A4"><span class="toc-number">7.1.</span> <span class="toc-text">docker run命令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E4%B8%8E%E7%BC%96%E6%8E%92"><span class="toc-number">8.</span> <span class="toc-text">容器镜像构建与编排</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Dockerfile%E6%96%87%E4%BB%B6%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="toc-number">8.1.</span> <span class="toc-text">Dockerfile文件的指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-build"><span class="toc-number">8.2.</span> <span class="toc-text">Docker build</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%BC%96%E6%8E%92%E5%B7%A5%E5%85%B7%EF%BC%8Cdocker-compose"><span class="toc-number">8.3.</span> <span class="toc-text">服务编排工具，docker-compose</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#YAML-%E6%96%87%E4%BB%B6"><span class="toc-number">8.4.</span> <span class="toc-text">YAML 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-compose%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">8.5.</span> <span class="toc-text">docker-compose常用命令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#k8s%E4%BD%BF%E7%94%A8"><span class="toc-number">9.</span> <span class="toc-text">k8s使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#k8s%E4%B8%AD%E7%9A%84%E8%B5%84%E6%BA%90"><span class="toc-number">9.1.</span> <span class="toc-text">k8s中的资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pod"><span class="toc-number">9.2.</span> <span class="toc-text">Pod</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Label%E3%80%81Service-%E5%92%8C-Pod-%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">9.3.</span> <span class="toc-text">Label、Service 和 Pod 之间的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Deployment"><span class="toc-number">9.4.</span> <span class="toc-text">Deployment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#K8s-Service-%E5%92%8C-Nacos-Service-%E7%9A%84%E5%BC%82%E5%90%8C%E7%82%B9"><span class="toc-number">9.5.</span> <span class="toc-text">K8s Service 和 Nacos Service 的异同点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#REST%E6%9C%8D%E5%8A%A1%E3%80%81%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E4%B8%8E%E9%83%A8%E7%BD%B2"><span class="toc-number">10.</span> <span class="toc-text">REST服务、微服务开发与部署</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E4%BD%93%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="toc-number">10.1.</span> <span class="toc-text">单体应用程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%89%B9%E5%BE%81"><span class="toc-number">10.2.</span> <span class="toc-text">微服务架构模式的特征</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E5%A4%B4%E4%B8%8E%E5%93%8D%E5%BA%94%E4%BD%93"><span class="toc-number">10.3.</span> <span class="toc-text">响应头与响应体</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E8%BD%AC%E6%8D%A2%E5%99%A8%EF%BC%88Message-conversion%EF%BC%89"><span class="toc-number">10.4.</span> <span class="toc-text">消息转换器（Message conversion）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E4%BB%A3%E7%A0%81"><span class="toc-number">10.5.</span> <span class="toc-text">例子代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E7%BB%B4%E5%AE%9E%E8%B7%B5"><span class="toc-number">10.6.</span> <span class="toc-text">运维实践</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8ENACOS%E7%9A%84%E6%95%B0%E6%8D%AE%E9%85%8D%E7%BD%AE"><span class="toc-number">11.</span> <span class="toc-text">基于NACOS的数据配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E9%85%8D%E7%BD%AE"><span class="toc-number">11.1.</span> <span class="toc-text">微服务开发配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dataId-%E7%9A%84%E5%AE%8C%E6%95%B4%E6%A0%BC%E5%BC%8F"><span class="toc-number">11.2.</span> <span class="toc-text">dataId 的完整格式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8ENACOS%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0"><span class="toc-number">12.</span> <span class="toc-text">基于NACOS的服务注册与发现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-number">12.1.</span> <span class="toc-text">服务发现的好处</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Cloud-Alibaba"><span class="toc-number">12.2.</span> <span class="toc-text">Spring Cloud Alibaba</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%88%B0%E7%9A%84starter%E4%BE%9D%E8%B5%96"><span class="toc-number">12.3.</span> <span class="toc-text">使用到的starter依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E6%9C%8D%E5%8A%A1%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">12.4.</span> <span class="toc-text">调用服务的三种方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5"><span class="toc-number">12.5.</span> <span class="toc-text">健康检查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2"><span class="toc-number">12.6.</span> <span class="toc-text">服务部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-Nacos-%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0"><span class="toc-number">12.7.</span> <span class="toc-text">如何使用 Nacos 实现服务注册与发现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8ESentinel%E7%9A%84%E6%B5%81%E6%8E%A7%E4%B8%8E%E7%86%94%E6%96%AD"><span class="toc-number">13.</span> <span class="toc-text">基于Sentinel的流控与熔断</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E8%B5%84%E6%BA%90%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">13.1.</span> <span class="toc-text">定义资源的方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%84%E5%88%99%E7%9A%84%E7%A7%8D%E7%B1%BB"><span class="toc-number">13.2.</span> <span class="toc-text">规则的种类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%86%94%E6%96%AD%E7%AD%96%E7%95%A5"><span class="toc-number">13.3.</span> <span class="toc-text">熔断策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sentinel%E7%BB%84%E6%88%90"><span class="toc-number">13.4.</span> <span class="toc-text">Sentinel组成</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BE%80%E5%B9%B4%E7%AE%80%E7%AD%94%E9%A2%98"><span class="toc-number">14.</span> <span class="toc-text">往年简答题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB-MVC-%E5%88%86%E5%B1%82"><span class="toc-number">14.1.</span> <span class="toc-text">WEB MVC 分层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9B%B8%E6%AF%94%E4%BA%8E%E4%BC%A0%E7%BB%9F%E7%9A%84%E5%8D%95%E4%BD%93%E4%B8%9A%E5%8A%A1%E6%9C%89%E4%BB%80%E4%B9%88%E4%BC%98%E5%8A%BF%EF%BC%8C%E4%B8%BA%E4%BD%95%E5%85%B3%E6%B3%A8%E5%BE%AE%E6%9C%8D%E5%8A%A1%EF%BC%8C%E6%9C%89%E4%BB%80%E4%B9%88%E5%85%B8%E5%9E%8B%E7%89%B9%E5%BE%81%EF%BC%8C%E5%8D%95%E4%BD%93%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E8%B6%B3"><span class="toc-number">14.2.</span> <span class="toc-text">微服务相比于传统的单体业务有什么优势，为何关注微服务，有什么典型特征，单体有什么不足</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-number">14.3.</span> <span class="toc-text">服务注册与发现的好处</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/06/19/SOA%E5%A4%8D%E4%B9%A0/" title="SOA复习"><img src="/img/SAO.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="SOA复习"></a><div class="content"><a class="title" href="/2023/06/19/SOA%E5%A4%8D%E4%B9%A0/" title="SOA复习">SOA复习</a><time datetime="2023-06-19T08:00:00.000Z" title="发表于 2023-06-19 16:00:00">2023-06-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/04/08/%E9%9D%A2%E5%90%91%E6%9C%8D%E5%8A%A1%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E5%A4%8D%E4%B9%A0/" title="面向服务的软件工程复习"><img src="/img/flower.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="面向服务的软件工程复习"></a><div class="content"><a class="title" href="/2023/04/08/%E9%9D%A2%E5%90%91%E6%9C%8D%E5%8A%A1%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E5%A4%8D%E4%B9%A0/" title="面向服务的软件工程复习">面向服务的软件工程复习</a><time datetime="2023-04-08T14:20:00.000Z" title="发表于 2023-04-08 22:20:00">2023-04-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/04/08/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91%E5%A4%8D%E4%B9%A0/" title="服务端开发复习"><img src="/img/fuwu.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="服务端开发复习"></a><div class="content"><a class="title" href="/2023/04/08/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91%E5%A4%8D%E4%B9%A0/" title="服务端开发复习">服务端开发复习</a><time datetime="2023-04-08T08:20:00.000Z" title="发表于 2023-04-08 16:20:00">2023-04-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/20/hello-myBlog/" title="Hello My Blog"><img src="/img/yinghua.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Hello My Blog"></a><div class="content"><a class="title" href="/2023/03/20/hello-myBlog/" title="Hello My Blog">Hello My Blog</a><time datetime="2023-03-20T12:00:00.000Z" title="发表于 2023-03-20 20:00:00">2023-03-20</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url('/img/fuwu.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By REHE</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>